# مرحلة البناء
FROM rust:slim as builder

WORKDIR /app

# نسخ ملفات Cargo أولاً للبناء السريع (cache layers)
COPY Cargo.toml Cargo.lock ./
COPY src ./src

# بناء البرنامج في وضع release
RUN cargo build --release

# مرحلة التشغيل
FROM debian:bullseye-slim

WORKDIR /app

# نسخ binary فقط من مرحلة البناء
COPY --from=builder /app/target/release/websocket_candle_rust /app/websocket_candle_rust

# تشغيل binary مباشرة
CMD ["./websocket_candle_rust"]
